{"id":"../node_modules/amis/lib/renderers/Form/Transfer.js","dependencies":[{"name":"/usr/local/work/amis-editor/package.json","includedInParent":true,"mtime":1607074594934},{"name":"/usr/local/work/amis-editor/node_modules/amis/package.json","includedInParent":true,"mtime":1606632442645},{"name":"tslib","loc":{"line":4,"column":22},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/tslib/tslib.es6.js"},{"name":"./Options","loc":{"line":8,"column":24},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Options.js"},{"name":"react","loc":{"line":6,"column":46},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/react/index.js"},{"name":"../../components/Transfer","loc":{"line":7,"column":49},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/components/Transfer.js"},{"name":"../../utils/helper","loc":{"line":9,"column":23},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/utils/helper.js"},{"name":"../../components/Spinner","loc":{"line":10,"column":48},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/components/Spinner.js"},{"name":"lodash/find","loc":{"line":11,"column":45},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/lodash/find.js"},{"name":"../../components/Select","loc":{"line":12,"column":23},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/components/Select.js"},{"name":"../../utils/tpl-builtin","loc":{"line":13,"column":28},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/renderers/Form/Transfer.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/utils/tpl-builtin.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransferRender = exports.BaseTransferRenderer = void 0;\nvar tslib_1 = require(\"tslib\");\nvar Options_1 = require(\"./Options\");\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\nvar Transfer_1 = tslib_1.__importDefault(require(\"../../components/Transfer\"));\nvar Options_2 = require(\"./Options\");\nvar helper_1 = require(\"../../utils/helper\");\nvar Spinner_1 = tslib_1.__importDefault(require(\"../../components/Spinner\"));\nvar find_1 = tslib_1.__importDefault(require(\"lodash/find\"));\nvar Select_1 = require(\"../../components/Select\");\nvar tpl_builtin_1 = require(\"../../utils/tpl-builtin\");\nvar BaseTransferRenderer = /** @class */ (function (_super) {\n    tslib_1.__extends(BaseTransferRenderer, _super);\n    function BaseTransferRenderer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BaseTransferRenderer.prototype.handleChange = function (value) {\n        var _a = this.props, onChange = _a.onChange, joinValues = _a.joinValues, delimiter = _a.delimiter, valueField = _a.valueField, extractValue = _a.extractValue, options = _a.options, setOptions = _a.setOptions;\n        var newValue = value;\n        var newOptions = options.concat();\n        if (Array.isArray(value)) {\n            if (joinValues || extractValue) {\n                newValue = value.map(function (item) {\n                    var resolved = helper_1.findTree(options, Select_1.optionValueCompare(item[valueField || 'value'], valueField || 'value'));\n                    if (!resolved) {\n                        newOptions.push(item);\n                    }\n                    return item[valueField || 'value'];\n                });\n            }\n            if (joinValues) {\n                newValue = newValue.join(delimiter || ',');\n            }\n        }\n        newOptions.length > options.length && setOptions(newOptions, true);\n        onChange(newValue);\n    };\n    BaseTransferRenderer.prototype.option2value = function (option) {\n        return option;\n    };\n    BaseTransferRenderer.prototype.handleSearch = function (term, cancelExecutor) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, searchApi, options, labelField, valueField, env, data, payload, result, e_1, regexp_1;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.props, searchApi = _a.searchApi, options = _a.options, labelField = _a.labelField, valueField = _a.valueField, env = _a.env, data = _a.data;\n                        if (!searchApi) return [3 /*break*/, 5];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, env.fetcher(searchApi, helper_1.createObject(data, { term: term }), {\n                                cancelExecutor: cancelExecutor\n                            })];\n                    case 2:\n                        payload = _b.sent();\n                        if (!payload.ok) {\n                            throw new Error(payload.msg || '搜索请求异常');\n                        }\n                        result = payload.data.options || payload.data.items || payload.data;\n                        if (!Array.isArray(result)) {\n                            throw new Error('期望接口返回数组信息');\n                        }\n                        return [2 /*return*/, result.map(function (item) {\n                                var resolved = null;\n                                var value = item[valueField || 'value'];\n                                // 只有 value 值有意义的时候，再去找；否则直接返回\n                                if (Array.isArray(options) && value !== null && value !== undefined) {\n                                    resolved = find_1.default(options, Select_1.optionValueCompare(value, valueField));\n                                }\n                                return resolved || item;\n                            })];\n                    case 3:\n                        e_1 = _b.sent();\n                        if (!env.isCancel(e_1)) {\n                            env.notify('error', e_1.message);\n                        }\n                        return [2 /*return*/, []];\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        if (term) {\n                            regexp_1 = helper_1.string2regExp(term);\n                            return [2 /*return*/, helper_1.filterTree(options, function (option) {\n                                    return !!((Array.isArray(option.children) && option.children.length) ||\n                                        regexp_1.test(option[labelField || 'label']) ||\n                                        regexp_1.test(option[valueField || 'value']));\n                                }, 0, true)];\n                        }\n                        else {\n                            return [2 /*return*/, options];\n                        }\n                        _b.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    BaseTransferRenderer.prototype.renderCell = function (column, option, colIndex, rowIndex) {\n        var _a = this.props, render = _a.render, data = _a.data;\n        return render(\"cell/\" + colIndex + \"/\" + rowIndex, tslib_1.__assign({ type: 'text' }, column), {\n            value: tpl_builtin_1.resolveVariable(column.name, option),\n            data: helper_1.createObject(data, option)\n        });\n    };\n    BaseTransferRenderer.prototype.render = function () {\n        var _a = this.props, className = _a.className, cx = _a.classnames, options = _a.options, selectedOptions = _a.selectedOptions, showArrow = _a.showArrow, sortable = _a.sortable, selectMode = _a.selectMode, columns = _a.columns, loading = _a.loading, searchable = _a.searchable, searchResultMode = _a.searchResultMode, deferLoad = _a.deferLoad, leftOptions = _a.leftOptions, leftMode = _a.leftMode, rightMode = _a.rightMode, disabled = _a.disabled;\n        return (react_1.default.createElement(\"div\", { className: cx('TransferControl', className) },\n            react_1.default.createElement(Transfer_1.default, { value: selectedOptions, options: options, disabled: disabled, onChange: this.handleChange, option2value: this.option2value, sortable: sortable, showArrow: showArrow, selectMode: selectMode, searchResultMode: searchResultMode, columns: columns, onSearch: searchable ? this.handleSearch : undefined, onDeferLoad: deferLoad, leftOptions: leftOptions, leftMode: leftMode, rightMode: rightMode, cellRender: this.renderCell }),\n            react_1.default.createElement(Spinner_1.default, { overlay: true, key: \"info\", show: loading })));\n    };\n    var _a, _b, _c, _d;\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof Array !== \"undefined\" && Array) === \"function\" ? _a : Object]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"handleChange\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_b = typeof Options_2.Option !== \"undefined\" && Options_2.Option) === \"function\" ? _b : Object]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"option2value\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [String, typeof (_c = typeof Function !== \"undefined\" && Function) === \"function\" ? _c : Object]),\n        tslib_1.__metadata(\"design:returntype\", Promise)\n    ], BaseTransferRenderer.prototype, \"handleSearch\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [Object, typeof (_d = typeof Options_2.Option !== \"undefined\" && Options_2.Option) === \"function\" ? _d : Object, Number, Number]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"renderCell\", null);\n    return BaseTransferRenderer;\n}(react_1.default.Component));\nexports.BaseTransferRenderer = BaseTransferRenderer;\n// ts 3.9 里面非得这样才不报错，鬼知道为何。\nvar TransferRender = /** @class */ (function (_super) {\n    tslib_1.__extends(TransferRender, _super);\n    function TransferRender() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return TransferRender;\n}(BaseTransferRenderer));\nexports.TransferRender = TransferRender;\nexports.default = Options_1.OptionsControl({\n    type: 'transfer'\n})(TransferRender);\n\n"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":2,"column":0},"generated":{"line":2,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":3,"column":0},"generated":{"line":3,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":4,"column":0},"generated":{"line":4,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":5,"column":0},"generated":{"line":5,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":6,"column":0},"generated":{"line":6,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":7,"column":0},"generated":{"line":7,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":8,"column":0},"generated":{"line":8,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":9,"column":0},"generated":{"line":9,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":10,"column":0},"generated":{"line":10,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":11,"column":0},"generated":{"line":11,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":12,"column":0},"generated":{"line":12,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":13,"column":0},"generated":{"line":13,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":14,"column":0},"generated":{"line":14,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":15,"column":0},"generated":{"line":15,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":16,"column":0},"generated":{"line":16,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":17,"column":0},"generated":{"line":17,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":18,"column":0},"generated":{"line":18,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":19,"column":0},"generated":{"line":19,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":20,"column":0},"generated":{"line":20,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":21,"column":0},"generated":{"line":21,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":22,"column":0},"generated":{"line":22,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":23,"column":0},"generated":{"line":23,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":25,"column":0},"generated":{"line":25,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":26,"column":0},"generated":{"line":26,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":27,"column":0},"generated":{"line":27,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":28,"column":0},"generated":{"line":28,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":29,"column":0},"generated":{"line":29,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":30,"column":0},"generated":{"line":30,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":31,"column":0},"generated":{"line":31,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":32,"column":0},"generated":{"line":32,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":33,"column":0},"generated":{"line":33,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":34,"column":0},"generated":{"line":34,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":35,"column":0},"generated":{"line":35,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":36,"column":0},"generated":{"line":36,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":37,"column":0},"generated":{"line":37,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":38,"column":0},"generated":{"line":38,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":39,"column":0},"generated":{"line":39,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":40,"column":0},"generated":{"line":40,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":41,"column":0},"generated":{"line":41,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":42,"column":0},"generated":{"line":42,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":43,"column":0},"generated":{"line":43,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":44,"column":0},"generated":{"line":44,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":45,"column":0},"generated":{"line":45,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":46,"column":0},"generated":{"line":46,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":47,"column":0},"generated":{"line":47,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":48,"column":0},"generated":{"line":48,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":49,"column":0},"generated":{"line":49,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":50,"column":0},"generated":{"line":50,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":51,"column":0},"generated":{"line":51,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":52,"column":0},"generated":{"line":52,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":53,"column":0},"generated":{"line":53,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":54,"column":0},"generated":{"line":54,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":55,"column":0},"generated":{"line":55,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":56,"column":0},"generated":{"line":56,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":57,"column":0},"generated":{"line":57,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":58,"column":0},"generated":{"line":58,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":59,"column":0},"generated":{"line":59,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":60,"column":0},"generated":{"line":60,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":61,"column":0},"generated":{"line":61,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":62,"column":0},"generated":{"line":62,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":63,"column":0},"generated":{"line":63,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":64,"column":0},"generated":{"line":64,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":65,"column":0},"generated":{"line":65,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":66,"column":0},"generated":{"line":66,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":67,"column":0},"generated":{"line":67,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":68,"column":0},"generated":{"line":68,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":69,"column":0},"generated":{"line":69,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":70,"column":0},"generated":{"line":70,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":71,"column":0},"generated":{"line":71,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":72,"column":0},"generated":{"line":72,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":73,"column":0},"generated":{"line":73,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":74,"column":0},"generated":{"line":74,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":75,"column":0},"generated":{"line":75,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":76,"column":0},"generated":{"line":76,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":77,"column":0},"generated":{"line":77,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":78,"column":0},"generated":{"line":78,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":79,"column":0},"generated":{"line":79,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":80,"column":0},"generated":{"line":80,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":81,"column":0},"generated":{"line":81,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":82,"column":0},"generated":{"line":82,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":83,"column":0},"generated":{"line":83,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":84,"column":0},"generated":{"line":84,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":85,"column":0},"generated":{"line":85,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":86,"column":0},"generated":{"line":86,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":87,"column":0},"generated":{"line":87,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":88,"column":0},"generated":{"line":88,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":89,"column":0},"generated":{"line":89,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":90,"column":0},"generated":{"line":90,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":91,"column":0},"generated":{"line":91,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":92,"column":0},"generated":{"line":92,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":93,"column":0},"generated":{"line":93,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":94,"column":0},"generated":{"line":94,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":95,"column":0},"generated":{"line":95,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":96,"column":0},"generated":{"line":96,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":97,"column":0},"generated":{"line":97,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":98,"column":0},"generated":{"line":98,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":99,"column":0},"generated":{"line":99,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":100,"column":0},"generated":{"line":100,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":101,"column":0},"generated":{"line":101,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":102,"column":0},"generated":{"line":102,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":103,"column":0},"generated":{"line":103,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":104,"column":0},"generated":{"line":104,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":105,"column":0},"generated":{"line":105,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":106,"column":0},"generated":{"line":106,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":107,"column":0},"generated":{"line":107,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":108,"column":0},"generated":{"line":108,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":109,"column":0},"generated":{"line":109,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":110,"column":0},"generated":{"line":110,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":111,"column":0},"generated":{"line":111,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":112,"column":0},"generated":{"line":112,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":113,"column":0},"generated":{"line":113,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":114,"column":0},"generated":{"line":114,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":115,"column":0},"generated":{"line":115,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":116,"column":0},"generated":{"line":116,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":117,"column":0},"generated":{"line":117,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":118,"column":0},"generated":{"line":118,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":119,"column":0},"generated":{"line":119,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":120,"column":0},"generated":{"line":120,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":121,"column":0},"generated":{"line":121,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":122,"column":0},"generated":{"line":122,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":123,"column":0},"generated":{"line":123,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":124,"column":0},"generated":{"line":124,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":125,"column":0},"generated":{"line":125,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":126,"column":0},"generated":{"line":126,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":127,"column":0},"generated":{"line":127,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":128,"column":0},"generated":{"line":128,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":129,"column":0},"generated":{"line":129,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":130,"column":0},"generated":{"line":130,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":131,"column":0},"generated":{"line":131,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":132,"column":0},"generated":{"line":132,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":133,"column":0},"generated":{"line":133,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":134,"column":0},"generated":{"line":134,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":135,"column":0},"generated":{"line":135,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":136,"column":0},"generated":{"line":136,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":137,"column":0},"generated":{"line":137,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":138,"column":0},"generated":{"line":138,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":139,"column":0},"generated":{"line":139,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":140,"column":0},"generated":{"line":140,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":141,"column":0},"generated":{"line":141,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":142,"column":0},"generated":{"line":142,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":143,"column":0},"generated":{"line":143,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":144,"column":0},"generated":{"line":144,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":145,"column":0},"generated":{"line":145,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":146,"column":0},"generated":{"line":146,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":147,"column":0},"generated":{"line":147,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":148,"column":0},"generated":{"line":148,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":149,"column":0},"generated":{"line":149,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":150,"column":0},"generated":{"line":150,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":151,"column":0},"generated":{"line":151,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":152,"column":0},"generated":{"line":152,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":153,"column":0},"generated":{"line":153,"column":0}},{"source":"../node_modules/amis/lib/renderers/Form/Transfer.js","original":{"line":154,"column":0},"generated":{"line":154,"column":0}}],"sources":{"../node_modules/amis/lib/renderers/Form/Transfer.js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransferRender = exports.BaseTransferRenderer = void 0;\nvar tslib_1 = require(\"tslib\");\nvar Options_1 = require(\"./Options\");\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\nvar Transfer_1 = tslib_1.__importDefault(require(\"../../components/Transfer\"));\nvar Options_2 = require(\"./Options\");\nvar helper_1 = require(\"../../utils/helper\");\nvar Spinner_1 = tslib_1.__importDefault(require(\"../../components/Spinner\"));\nvar find_1 = tslib_1.__importDefault(require(\"lodash/find\"));\nvar Select_1 = require(\"../../components/Select\");\nvar tpl_builtin_1 = require(\"../../utils/tpl-builtin\");\nvar BaseTransferRenderer = /** @class */ (function (_super) {\n    tslib_1.__extends(BaseTransferRenderer, _super);\n    function BaseTransferRenderer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BaseTransferRenderer.prototype.handleChange = function (value) {\n        var _a = this.props, onChange = _a.onChange, joinValues = _a.joinValues, delimiter = _a.delimiter, valueField = _a.valueField, extractValue = _a.extractValue, options = _a.options, setOptions = _a.setOptions;\n        var newValue = value;\n        var newOptions = options.concat();\n        if (Array.isArray(value)) {\n            if (joinValues || extractValue) {\n                newValue = value.map(function (item) {\n                    var resolved = helper_1.findTree(options, Select_1.optionValueCompare(item[valueField || 'value'], valueField || 'value'));\n                    if (!resolved) {\n                        newOptions.push(item);\n                    }\n                    return item[valueField || 'value'];\n                });\n            }\n            if (joinValues) {\n                newValue = newValue.join(delimiter || ',');\n            }\n        }\n        newOptions.length > options.length && setOptions(newOptions, true);\n        onChange(newValue);\n    };\n    BaseTransferRenderer.prototype.option2value = function (option) {\n        return option;\n    };\n    BaseTransferRenderer.prototype.handleSearch = function (term, cancelExecutor) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, searchApi, options, labelField, valueField, env, data, payload, result, e_1, regexp_1;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.props, searchApi = _a.searchApi, options = _a.options, labelField = _a.labelField, valueField = _a.valueField, env = _a.env, data = _a.data;\n                        if (!searchApi) return [3 /*break*/, 5];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, env.fetcher(searchApi, helper_1.createObject(data, { term: term }), {\n                                cancelExecutor: cancelExecutor\n                            })];\n                    case 2:\n                        payload = _b.sent();\n                        if (!payload.ok) {\n                            throw new Error(payload.msg || '搜索请求异常');\n                        }\n                        result = payload.data.options || payload.data.items || payload.data;\n                        if (!Array.isArray(result)) {\n                            throw new Error('期望接口返回数组信息');\n                        }\n                        return [2 /*return*/, result.map(function (item) {\n                                var resolved = null;\n                                var value = item[valueField || 'value'];\n                                // 只有 value 值有意义的时候，再去找；否则直接返回\n                                if (Array.isArray(options) && value !== null && value !== undefined) {\n                                    resolved = find_1.default(options, Select_1.optionValueCompare(value, valueField));\n                                }\n                                return resolved || item;\n                            })];\n                    case 3:\n                        e_1 = _b.sent();\n                        if (!env.isCancel(e_1)) {\n                            env.notify('error', e_1.message);\n                        }\n                        return [2 /*return*/, []];\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        if (term) {\n                            regexp_1 = helper_1.string2regExp(term);\n                            return [2 /*return*/, helper_1.filterTree(options, function (option) {\n                                    return !!((Array.isArray(option.children) && option.children.length) ||\n                                        regexp_1.test(option[labelField || 'label']) ||\n                                        regexp_1.test(option[valueField || 'value']));\n                                }, 0, true)];\n                        }\n                        else {\n                            return [2 /*return*/, options];\n                        }\n                        _b.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    BaseTransferRenderer.prototype.renderCell = function (column, option, colIndex, rowIndex) {\n        var _a = this.props, render = _a.render, data = _a.data;\n        return render(\"cell/\" + colIndex + \"/\" + rowIndex, tslib_1.__assign({ type: 'text' }, column), {\n            value: tpl_builtin_1.resolveVariable(column.name, option),\n            data: helper_1.createObject(data, option)\n        });\n    };\n    BaseTransferRenderer.prototype.render = function () {\n        var _a = this.props, className = _a.className, cx = _a.classnames, options = _a.options, selectedOptions = _a.selectedOptions, showArrow = _a.showArrow, sortable = _a.sortable, selectMode = _a.selectMode, columns = _a.columns, loading = _a.loading, searchable = _a.searchable, searchResultMode = _a.searchResultMode, deferLoad = _a.deferLoad, leftOptions = _a.leftOptions, leftMode = _a.leftMode, rightMode = _a.rightMode, disabled = _a.disabled;\n        return (react_1.default.createElement(\"div\", { className: cx('TransferControl', className) },\n            react_1.default.createElement(Transfer_1.default, { value: selectedOptions, options: options, disabled: disabled, onChange: this.handleChange, option2value: this.option2value, sortable: sortable, showArrow: showArrow, selectMode: selectMode, searchResultMode: searchResultMode, columns: columns, onSearch: searchable ? this.handleSearch : undefined, onDeferLoad: deferLoad, leftOptions: leftOptions, leftMode: leftMode, rightMode: rightMode, cellRender: this.renderCell }),\n            react_1.default.createElement(Spinner_1.default, { overlay: true, key: \"info\", show: loading })));\n    };\n    var _a, _b, _c, _d;\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof Array !== \"undefined\" && Array) === \"function\" ? _a : Object]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"handleChange\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_b = typeof Options_2.Option !== \"undefined\" && Options_2.Option) === \"function\" ? _b : Object]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"option2value\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [String, typeof (_c = typeof Function !== \"undefined\" && Function) === \"function\" ? _c : Object]),\n        tslib_1.__metadata(\"design:returntype\", Promise)\n    ], BaseTransferRenderer.prototype, \"handleSearch\", null);\n    tslib_1.__decorate([\n        helper_1.autobind,\n        tslib_1.__metadata(\"design:type\", Function),\n        tslib_1.__metadata(\"design:paramtypes\", [Object, typeof (_d = typeof Options_2.Option !== \"undefined\" && Options_2.Option) === \"function\" ? _d : Object, Number, Number]),\n        tslib_1.__metadata(\"design:returntype\", void 0)\n    ], BaseTransferRenderer.prototype, \"renderCell\", null);\n    return BaseTransferRenderer;\n}(react_1.default.Component));\nexports.BaseTransferRenderer = BaseTransferRenderer;\n// ts 3.9 里面非得这样才不报错，鬼知道为何。\nvar TransferRender = /** @class */ (function (_super) {\n    tslib_1.__extends(TransferRender, _super);\n    function TransferRender() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return TransferRender;\n}(BaseTransferRenderer));\nexports.TransferRender = TransferRender;\nexports.default = Options_1.OptionsControl({\n    type: 'transfer'\n})(TransferRender);\n\n"},"lineCount":154}},"error":null,"hash":"b245455f035dec60af49c4c747634600","cacheData":{"env":{}}}