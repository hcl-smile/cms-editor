{"id":"../node_modules/amis/lib/locale.js","dependencies":[{"name":"/usr/local/work/amis-editor/node_modules/amis/lib/locale.js.map","includedInParent":true,"mtime":1606632442645},{"name":"/usr/local/work/amis-editor/package.json","includedInParent":true,"mtime":1607074594934},{"name":"/usr/local/work/amis-editor/node_modules/amis/package.json","includedInParent":true,"mtime":1606632442645},{"name":"tslib","loc":{"line":4,"column":22},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/locale.js","resolved":"/usr/local/work/amis-editor/node_modules/tslib/tslib.es6.js"},{"name":"react","loc":{"line":6,"column":46},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/locale.js","resolved":"/usr/local/work/amis-editor/node_modules/react/index.js"},{"name":"hoist-non-react-statics","loc":{"line":7,"column":64},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/locale.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"},{"name":"./utils/tpl-builtin","loc":{"line":8,"column":28},"parent":"/usr/local/work/amis-editor/node_modules/amis/lib/locale.js","resolved":"/usr/local/work/amis-editor/node_modules/amis/lib/utils/tpl-builtin.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.localeable = exports.LocaleContext = exports.setDefaultLocale = exports.getDefaultLocale = exports.makeTranslator = exports.register = void 0;\nvar tslib_1 = require(\"tslib\");\n// 多语言支持\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\nvar hoist_non_react_statics_1 = tslib_1.__importDefault(require(\"hoist-non-react-statics\"));\nvar tpl_builtin_1 = require(\"./utils/tpl-builtin\");\nvar defaultLocale = 'zh-cn';\nvar locales = {};\nfunction register(name, config) {\n    locales[name] = config;\n}\nexports.register = register;\nvar fns = {};\nfunction format(str, data) {\n    return str.replace(/(\\\\)?\\{\\{([\\s\\S]+?)\\}\\}/g, function (_, escape, key) {\n        if (escape) {\n            return _.substring(1);\n        }\n        return tpl_builtin_1.resolveVariable(key, data || {});\n    });\n}\nfunction makeTranslator(locale) {\n    if (locale && fns[locale]) {\n        return fns[locale];\n    }\n    var fn = function (str) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        if (!str || typeof str !== 'string') {\n            return str;\n        }\n        var dict = locales[locale] || locales[defaultLocale];\n        return format.apply(void 0, tslib_1.__spreadArrays([(dict === null || dict === void 0 ? void 0 : dict[str]) || str], args));\n    };\n    locale && (fns[locale] = fn);\n    return fn;\n}\nexports.makeTranslator = makeTranslator;\nfunction getDefaultLocale() {\n    return defaultLocale;\n}\nexports.getDefaultLocale = getDefaultLocale;\nfunction setDefaultLocale(loacle) {\n    defaultLocale = loacle;\n}\nexports.setDefaultLocale = setDefaultLocale;\nexports.LocaleContext = react_1.default.createContext('');\nfunction localeable(ComposedComponent) {\n    var _a;\n    var result = hoist_non_react_statics_1.default((_a = /** @class */ (function (_super) {\n            tslib_1.__extends(class_1, _super);\n            function class_1() {\n                return _super !== null && _super.apply(this, arguments) || this;\n            }\n            class_1.prototype.render = function () {\n                var locale = this.props.locale || this.context || defaultLocale;\n                var translate = this.props.translate || makeTranslator(locale);\n                var injectedProps = {\n                    locale: locale,\n                    translate: translate\n                };\n                return (react_1.default.createElement(exports.LocaleContext.Provider, { value: locale },\n                    react_1.default.createElement(ComposedComponent, tslib_1.__assign({}, this.props, injectedProps))));\n            };\n            return class_1;\n        }(react_1.default.Component)),\n        _a.displayName = \"I18N(\" + (ComposedComponent.displayName || ComposedComponent.name) + \")\",\n        _a.contextType = exports.LocaleContext,\n        _a.ComposedComponent = ComposedComponent,\n        _a), ComposedComponent);\n    return result;\n}\nexports.localeable = localeable;\n\n"},"sourceMaps":{"js":{"version":3,"file":"locale.js","sourceRoot":"","sources":["/src/locale.tsx"],"names":[],"mappings":";;;;AAAA,QAAQ;AACR,wDAA0B;AAC1B,4FAA0D;AAC1D,mDAAoD;AAQpD,IAAI,aAAa,GAAW,OAAO,CAAC;AAEpC,IAAM,OAAO,GAET,EAAE,CAAC;AAEP,SAAgB,QAAQ,CAAC,IAAY,EAAE,MAAoB;IACzD,OAAO,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC;AACzB,CAAC;AAFD,4BAEC;AAED,IAAM,GAAG,GAEL,EAAE,CAAC;AAEP,SAAS,MAAM,CAAC,GAAW,EAAE,IAAa;IACxC,OAAO,GAAG,CAAC,OAAO,CAAC,0BAA0B,EAAE,UAAC,CAAC,EAAE,MAAM,EAAE,GAAG;QAC5D,IAAI,MAAM,EAAE;YACV,OAAO,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;SACvB;QAED,OAAO,6BAAe,CAAC,GAAG,EAAE,IAAI,IAAI,EAAE,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAgB,cAAc,CAAC,MAAe;IAC5C,IAAI,MAAM,IAAI,GAAG,CAAC,MAAM,CAAC,EAAE;QACzB,OAAO,GAAG,CAAC,MAAM,CAAC,CAAC;KACpB;IAED,IAAM,EAAE,GAAG,UAAC,GAAQ;QAAE,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,6BAAc;;QAClC,IAAI,CAAC,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;YACnC,OAAO,GAAG,CAAC;SACZ;QAED,IAAM,IAAI,GAAG,OAAO,CAAC,MAAO,CAAC,IAAI,OAAO,CAAC,aAAa,CAAC,CAAC;QACxD,OAAO,MAAM,uCAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAG,GAAG,MAAK,GAAG,GAAK,IAAI,GAAE;IAC7C,CAAC,CAAC;IAEF,MAAM,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC;IAC7B,OAAO,EAAE,CAAC;AACZ,CAAC;AAhBD,wCAgBC;AAED,SAAgB,gBAAgB;IAC9B,OAAO,aAAa,CAAC;AACvB,CAAC;AAFD,4CAEC;AAED,SAAgB,gBAAgB,CAAC,MAAc;IAC7C,aAAa,GAAG,MAAM,CAAC;AACzB,CAAC;AAFD,4CAEC;AAOY,QAAA,aAAa,GAAG,eAAK,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;AAErD,SAAgB,UAAU,CAExB,iBAAoB;;IASpB,IAAM,MAAM,GAAG,iCAAmB;YAClB,mCAA2B;YAAzC;;YA+BA,CAAC;YAxBC,wBAAM,GAAN;gBACE,IAAM,MAAM,GACV,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,IAAI,aAAa,CAAC;gBACrD,IAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,cAAc,CAAC,MAAM,CAAC,CAAC;gBACjE,IAAM,aAAa,GAGf;oBACF,MAAM,QAAA;oBACN,SAAS,EAAE,SAAU;iBACtB,CAAC;gBAEF,OAAO,CACL,8BAAC,qBAAa,CAAC,QAAQ,IAAC,KAAK,EAAE,MAAM;oBACnC,8BAAC,iBAAiB,uBACX,IAAI,CAAC,KAGR,EACE,aAAa,EACjB,CACqB,CAC1B,CAAC;YACJ,CAAC;YACH,cAAC;QAAD,CAAC,AA/BD,CAAc,eAAK,CAAC,SAAS;QACpB,cAAW,GAAG,WACnB,iBAAiB,CAAC,WAAW,IAAI,iBAAiB,CAAC,IAAI,OACrD;QACG,cAAW,GAAG,qBAAc;QAC5B,oBAAiB,GAAG,iBAAkB;aA2B/C,iBAAiB,CAClB,CAAC;IAEF,OAAO,MAEN,CAAC;AACJ,CAAC;AAlDD,gCAkDC","sourcesContent":["// 多语言支持\nimport React from 'react';\nimport hoistNonReactStatic from 'hoist-non-react-statics';\nimport {resolveVariable} from './utils/tpl-builtin';\n\nexport type TranslateFn<T = any> = (str: T, data?: object) => T;\n\ninterface LocaleConfig {\n  [propsName: string]: string;\n}\n\nlet defaultLocale: string = 'zh-cn';\n\nconst locales: {\n  [propName: string]: LocaleConfig;\n} = {};\n\nexport function register(name: string, config: LocaleConfig) {\n  locales[name] = config;\n}\n\nconst fns: {\n  [propName: string]: TranslateFn;\n} = {};\n\nfunction format(str: string, data?: object) {\n  return str.replace(/(\\\\)?\\{\\{([\\s\\S]+?)\\}\\}/g, (_, escape, key) => {\n    if (escape) {\n      return _.substring(1);\n    }\n\n    return resolveVariable(key, data || {});\n  });\n}\n\nexport function makeTranslator(locale?: string): TranslateFn {\n  if (locale && fns[locale]) {\n    return fns[locale];\n  }\n\n  const fn = (str: any, ...args: any[]) => {\n    if (!str || typeof str !== 'string') {\n      return str;\n    }\n\n    const dict = locales[locale!] || locales[defaultLocale];\n    return format(dict?.[str] || str, ...args);\n  };\n\n  locale && (fns[locale] = fn);\n  return fn;\n}\n\nexport function getDefaultLocale() {\n  return defaultLocale;\n}\n\nexport function setDefaultLocale(loacle: string) {\n  defaultLocale = loacle;\n}\n\nexport interface LocaleProps {\n  locale: string;\n  translate: TranslateFn;\n}\n\nexport const LocaleContext = React.createContext('');\n\nexport function localeable<\n  T extends React.ComponentType<React.ComponentProps<T> & LocaleProps>\n>(ComposedComponent: T) {\n  type OuterProps = JSX.LibraryManagedAttributes<\n    T,\n    Omit<React.ComponentProps<T>, keyof LocaleProps>\n  > & {\n    locale?: string;\n    translate?: (str: string, ...args: any[]) => string;\n  };\n\n  const result = hoistNonReactStatic(\n    class extends React.Component<OuterProps> {\n      static displayName = `I18N(${\n        ComposedComponent.displayName || ComposedComponent.name\n      })`;\n      static contextType = LocaleContext;\n      static ComposedComponent = ComposedComponent;\n\n      render() {\n        const locale: string =\n          this.props.locale || this.context || defaultLocale;\n        const translate = this.props.translate || makeTranslator(locale);\n        const injectedProps: {\n          locale: string;\n          translate: TranslateFn;\n        } = {\n          locale,\n          translate: translate!\n        };\n\n        return (\n          <LocaleContext.Provider value={locale}>\n            <ComposedComponent\n              {...(this.props as JSX.LibraryManagedAttributes<\n                T,\n                React.ComponentProps<T>\n              >)}\n              {...injectedProps}\n            />\n          </LocaleContext.Provider>\n        );\n      }\n    },\n    ComposedComponent\n  );\n\n  return result as typeof result & {\n    ComposedComponent: T;\n  };\n}\n"]}},"error":null,"hash":"789da1b4e16b23b97c0744084e48d33b","cacheData":{"env":{}}}